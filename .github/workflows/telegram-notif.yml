name: telegram message
on: [push, pull_request]
jobs:
    notify:
        name: Notify on Push, Pull Request
        runs-on: ubuntu-latest

        steps:
            - name: Send Telegram message on push
              if: github.event_name == 'push'
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_TO }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  format: markdown
                  message: |
                      *New Push Notification*
                      ðŸ”¹ *Repository:* `${{ github.repository }}`
                      ðŸ”¹ *Pushed by:* `${{ github.actor }}`
                      ðŸ”¹ *Pushed to:* `${{ github.ref_name }}`
                      ðŸ”¹ *Commit message:* `${{ github.event.head_commit.message }}`
                      ðŸ”¹  *Modified Files:*
                      ```
                      ${{ join(github.event.commits.*.modified, '\n') }}
                      ```
                      ðŸ”— View Commit: [Commit Link](https://github.com/${{ github.repository }}/commit/${{github.sha}})
                      ðŸ”— View Commits History: [Commits History Link](https://github.com/${{ github.repository }}/commit/${{ github.ref_name }})


            - name: Send Telegram message on pull request
              if: github.event_name == 'pull_request'
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_TO }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  format: markdown
                  message: |
                      *New Pull Request Notification*
                      ðŸ”¹ *Repository:* `${{ github.repository }}`
                      ðŸ”¹ *Title:* `${{ github.event.pull_request.title }}`
                      ðŸ”¹ *Author:* `${{ github.event.pull_request.user.login }}`
                      ðŸ”¹ *Description:*
                      `${{ github.event.pull_request.body }}`
                      [View Pull Request](`${{ github.event.pull_request.html_url }}`)

                      *Changed Files:*
                      ```
                      ${{ join(github.event.pull_request.changed_files.*.filename, '\n') }}
                      ```

            - name: Send Telegram message on stage commit
              if: github.event_name == 'push' && startsWith(github.ref, 'refs/heads/stage')
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_TO }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  format: markdown
                  message: |
                      *New Stage Commit Notification*
                      ðŸ”¹ *Repository:* `${{ github.repository }}`
                      ðŸ”¹ *Pushed by:* `${{ github.actor }}`
                      ðŸ”¹ *Pushed to stage branch:* `${{ github.ref_name }}`
                      ðŸ”¹ *Commit message:* `${{ github.event.head_commit.message }}`
                      ðŸ”— View Commit: [Commit Link](https://github.com/${{ github.repository }}/commit/${{github.sha}})

                      *Modified Files:*
                      ```
                      ${{ join(github.event.commits.*.modified, '\n') }}
                      ```
